(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();var K=typeof Float32Array<"u"?Float32Array:Array;function z(){var e=new K(16);return K!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ae(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oe(e,t){var r=t[0],i=t[1],n=t[2],c=t[3],a=t[4],o=t[5],l=t[6],d=t[7],f=t[8],y=t[9],h=t[10],u=t[11],w=t[12],g=t[13],A=t[14],E=t[15],R=r*o-i*a,S=r*l-n*a,M=r*d-c*a,P=i*l-n*o,B=i*d-c*o,D=n*d-c*l,F=f*g-y*w,I=f*A-h*w,L=f*E-u*w,O=y*A-h*g,T=y*E-u*g,_=h*E-u*A,p=R*_-S*T+M*O+P*L-B*I+D*F;return p?(p=1/p,e[0]=(o*_-l*T+d*O)*p,e[1]=(n*T-i*_-c*O)*p,e[2]=(g*D-A*B+E*P)*p,e[3]=(h*B-y*D-u*P)*p,e[4]=(l*L-a*_-d*I)*p,e[5]=(r*_-n*L+c*I)*p,e[6]=(A*M-w*D-E*S)*p,e[7]=(f*D-h*M+u*S)*p,e[8]=(a*T-o*L+d*F)*p,e[9]=(i*L-r*T-c*F)*p,e[10]=(w*B-g*M+E*R)*p,e[11]=(y*M-f*B-u*R)*p,e[12]=(o*I-a*O-l*F)*p,e[13]=(r*O-i*I+n*F)*p,e[14]=(g*S-w*P-A*R)*p,e[15]=(f*P-y*S+h*R)*p,e):null}function Q(e,t,r){var i=r[0],n=r[1],c=r[2],a,o,l,d,f,y,h,u,w,g,A,E;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*c+t[12],e[13]=t[1]*i+t[5]*n+t[9]*c+t[13],e[14]=t[2]*i+t[6]*n+t[10]*c+t[14],e[15]=t[3]*i+t[7]*n+t[11]*c+t[15]):(a=t[0],o=t[1],l=t[2],d=t[3],f=t[4],y=t[5],h=t[6],u=t[7],w=t[8],g=t[9],A=t[10],E=t[11],e[0]=a,e[1]=o,e[2]=l,e[3]=d,e[4]=f,e[5]=y,e[6]=h,e[7]=u,e[8]=w,e[9]=g,e[10]=A,e[11]=E,e[12]=a*i+f*n+w*c+t[12],e[13]=o*i+y*n+g*c+t[13],e[14]=l*i+h*n+A*c+t[14],e[15]=d*i+u*n+E*c+t[15]),e}function he(e,t,r){var i=Math.sin(r),n=Math.cos(r),c=t[4],a=t[5],o=t[6],l=t[7],d=t[8],f=t[9],y=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=c*n+d*i,e[5]=a*n+f*i,e[6]=o*n+y*i,e[7]=l*n+h*i,e[8]=d*n-c*i,e[9]=f*n-a*i,e[10]=y*n-o*i,e[11]=h*n-l*i,e}function le(e,t,r){var i=Math.sin(r),n=Math.cos(r),c=t[0],a=t[1],o=t[2],l=t[3],d=t[8],f=t[9],y=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*n-d*i,e[1]=a*n-f*i,e[2]=o*n-y*i,e[3]=l*n-h*i,e[8]=c*i+d*n,e[9]=a*i+f*n,e[10]=o*i+y*n,e[11]=l*i+h*n,e}function de(e,t,r,i,n){var c=1/Math.tan(t/2);if(e[0]=c/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0){var a=1/(i-n);e[10]=(n+i)*a,e[14]=2*n*i*a}else e[10]=-1,e[14]=-2*i;return e}var fe=de;function $(){var e=new K(3);return K!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ye(e){var t=new K(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ee(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function te(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}(function(){var e=$();return function(t,r,i,n,c,a){var o,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],c(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();class C{constructor(t,r=[0,0,0],i=1,n=1){this.cameraMatrix=z(),this.grounded=!1,this.velocity=[0,0,0],this.pitch=0,this.yaw=0,C.current=this,this.name=t,this.postition=r,this.speed=i,this.sensitivity=n*.1,Q(this.cameraMatrix,this.cameraMatrix,r)}look(t,r){this.yaw+=t*this.sensitivity*(Math.PI/180),this.pitch+=r*this.sensitivity*(Math.PI/180),this.pitch<-.9&&(this.pitch=-.9),this.pitch>.9&&(this.pitch=.9)}updateMatrix(){ae(this.cameraMatrix),Q(this.cameraMatrix,this.cameraMatrix,this.postition),le(this.cameraMatrix,this.cameraMatrix,this.yaw),he(this.cameraMatrix,this.cameraMatrix,this.pitch)}updatePosition(t,r){const i=Math.sin(this.yaw),n=Math.cos(this.yaw),c=i,a=n,o=n,l=-i,d=o*t[0]+c*t[2],f=l*t[0]+a*t[2];te(t,[d,t[1],f],this.speed*r),ee(this.postition,this.postition,t)}predictPosition(t,r){const i=ye(t),n=Math.sin(this.yaw),c=Math.cos(this.yaw),a=n,o=c,l=c,d=-n,f=l*i[0]+a*i[2],y=d*i[0]+o*i[2];te(i,[f,i[1],y],this.speed*r);const h=$();return ee(h,this.postition,i),h}}const ve=e=>{if(e===null)throw new Error("Canvas is null!");const t=e.getContext("webgl2");if(!t)throw new Error("Webgl2 not supported");return t.viewport(0,0,e.width,e.height),t},me=()=>{const e=document.querySelector("#render");if(e==null)throw new Error("Canvas is empty!");return e},m=me();m.width=m.clientWidth*window.devicePixelRatio;m.height=m.clientHeight*window.devicePixelRatio;const s=ve(m);s.viewport(0,0,m.width,m.height);const v=new C("Main",[0,1,5],2,1);let k=!1,X=!1,G=!1,W=!1,j=!1;m?.addEventListener("click",()=>{m?.requestPointerLock()});document.addEventListener("keydown",e=>{e.preventDefault(),e.code=="KeyW"&&(k=!0),e.code=="KeyA"&&(X=!0),e.code=="KeyS"&&(G=!0),e.code=="KeyD"&&(W=!0),e.code=="Space"&&(j=!0),e.shiftKey});document.addEventListener("keyup",e=>{e.code=="KeyW"&&(k=!1),e.code=="KeyA"&&(X=!1),e.code=="KeyS"&&(G=!1),e.code=="KeyD"&&(W=!1),e.code=="Space"&&(j=!1),e.shiftKey});document.addEventListener("mousemove",e=>{if(document.pointerLockElement!==m)return;let t=-e.movementX,r=-e.movementY;v.look(t,r)});document.addEventListener("pointerlockchange",()=>{document.pointerLockElement!==m&&(k=X=G=W=!1)});const b=5,U=1,re=0,x=.8,N=[];for(let e=1;e<5;e++){for(let t=-b/2;t<b/2;t++)for(let r=-b*e/2;r<b/2;r++)N.push({x:t*U*e,y:re,z:r*U*e,chunk:e});for(let t=-b/2;t<b/2;t++)for(let r=-b/2;r<b/2;r++)N.push({x:t*U,y:re+3,z:r*U,chunk:e})}function ue(){return be(N)}function we(e=2){const t=v.postition,r=e*e;return N.filter(i=>{const n=i.x-t[0],c=i.y-t[1],a=i.z-t[2];return n*n+c*c+a*a<=r})}function ge(e,t){const r=e.x,i=e.y,n=e.z,c=t[0]>=r-x&&t[0]<=r+x,a=t[1]>=i-x&&t[1]<=i+x,o=t[2]>=n-x&&t[2]<=n+x;return!(c&&a&&o)}function Ae(e,t){return e[t]=0,!1}function Z(e,t,r,i,n){return t=ge(e,i),t?!0:(Ae(r,n),!1)}function Ee(e,t){const r=[];pe(r,e);let i=!0,n=!0,c=!0;const a=v.predictPosition([e[0],0,0],t),o=v.predictPosition([0,e[1],0],t),l=v.predictPosition([0,0,e[2]],t);we().forEach(h=>{i=i?Z(h,i,e,a,0):!1,n=n?Z(h,n,e,o,1):!1,c=c?Z(h,c,e,l,2):!1});const f=!n&&r[1]>0,y=!n&&r[1]<0;return console.log(y),{move:e,hitGround:y,hitCeiling:f}}function be(e){const t=new Float32Array([-.5,-.5,.5,1,0,0,.5,-.5,.5,0,1,0,.5,-.5,-.5,0,0,1,-.5,-.5,-.5,1,1,0,-.5,.5,.5,1,0,0,.5,.5,.5,0,1,0,.5,.5,-.5,0,0,1,-.5,.5,-.5,1,1,0]),r=new Uint32Array([0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,3,0,4,4,7,3,4,5,6,6,7,4,0,3,2,2,1,0]),i=6,n=8,c=36;let a=0,o=0,l=0;const d=new Float32Array(e.length*n*i),f=new Uint32Array(e.length*c);for(const y of e){for(let h=0;h<t.length;h+=6)d[a++]=t[h]+y.x,d[a++]=t[h+1]+y.y,d[a++]=t[h+2]+y.z,d[a++]=t[h+3],d[a++]=t[h+4],d[a++]=t[h+5];for(let h=0;h<r.length;h++)f[o++]=r[h]+l;l+=n}return{vertices:d,indices:f}}class J{constructor(t,r){this.ID=s.createProgram();const i=this.compile(s.VERTEX_SHADER,t),n=this.compile(s.FRAGMENT_SHADER,r);this.cleanup(i,n)}compile(t,r){try{const i=s.createShader(t);if(i==null)throw new Error("The shader is empty!");return s.shaderSource(i,r),s.compileShader(i),i}catch(i){throw console.error(i),i}}cleanup(t,r){s.attachShader(this.ID,t),s.attachShader(this.ID,r),s.linkProgram(this.ID),s.detachShader(this.ID,t),s.detachShader(this.ID,r),s.deleteShader(t),s.deleteShader(r)}static async getShaderSource(t){try{const r=await fetch(`/assets/${t}`);if(!r.ok)throw new Error(`Error fetching shader: ${r.status}`);return await r.text()}catch(r){throw console.error(r),r}}useProgram(){s.useProgram(this.ID)}delete(){s.deleteProgram(this.ID)}}class xe{id;indices;constructor(t){this.id=s.createBuffer(),this.indices=t,s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.id),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t,s.STATIC_DRAW)}Bind(){s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.id)}unbind(){s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}delete(){s.deleteBuffer(this.id)}}class Re{constructor(t){this.ID=s.createBuffer(),this.vertices=t,s.bindBuffer(s.ARRAY_BUFFER,this.ID),s.bufferData(s.ARRAY_BUFFER,t,s.STATIC_DRAW)}setAttributes(t){this.bind(),s.vertexAttribPointer(t.location,t.points,s.FLOAT,!1,t.stride,t.offset),s.enableVertexAttribArray(t.location),this.unbind()}bind(){s.bindBuffer(s.ARRAY_BUFFER,this.ID)}unbind(){s.bindBuffer(s.ARRAY_BUFFER,null)}delete(){s.deleteBuffer(this.ID)}}class Se{constructor(t,r){this.EBO=null,this.ID=s.createVertexArray(),this.bind(),r&&(this.EBO=new xe(r)),this.VBO=new Re(t)}bind(){s.bindVertexArray(this.ID)}unbind(){s.bindVertexArray(null)}setLocationAttributes(t){this.bind(),this.VBO.setAttributes(t),this.unbind()}delete(){this.VBO.delete(),s.deleteVertexArray(this.ID)}}const Y=class Y{constructor(t,r,i,n,c,a){this.shape=r,this.name=t,this.vertices=i,this.indices=n,this.shaderProgram=new J(c,a),this.VAO=new Se(i,n),Y.meshes.set(t,this)}SetLocation(t,r,i,n){this.VAO.setLocationAttributes({location:t,points:r,stride:i,offset:n})}Draw(){const{shaderProgram:t,VAO:r}=this;if(t.useProgram(),r.bind(),this.indices)s.drawElements(this.shape,this.indices.length,s.UNSIGNED_INT,0);else throw new Error("No indices")}delete(){this.shaderProgram.delete(),this.VAO.delete()}};Y.meshes=new Map;let H=Y;s.clearColor(0,.5,.5,1);s.enable(s.DEPTH_TEST);const ie=z(),se=z(),Me=z();let q=0;const ne=ue(),Pe=await J.getShaderSource("vertex.vert"),Be=await J.getShaderSource("fragment.frag"),V=new H("ground",s.TRIANGLES,ne.vertices,ne.indices,Pe,Be);V.SetLocation(0,3,24,0);V.SetLocation(1,3,24,12);const De=-1;function Fe(e){const t=$();return k&&(t[2]-=1),X&&(t[0]-=1),G&&(t[2]+=1),W&&(t[0]+=1),j&&v.grounded?(v.grounded=!1,v.velocity[1]=1,t[1]=v.velocity[1]):v.grounded||(v.velocity[1]+=De*e,t[1]=v.velocity[1]),t}function Ie(e){const t=Fe(e);fe(se,Math.PI/4,m.width/m.height,.1,100);const r=Ee(t,e);r.hitGround?(v.velocity[1]=0,r.move[1]=0,v.grounded=!0):v.grounded=!1,r.hitCeiling&&(v.velocity[1]=0),v.updatePosition(r.move,e),v.updateMatrix()}function Le(){s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),oe(ie,C.current.cameraMatrix),V.shaderProgram.useProgram();const e=V.shaderProgram.ID;s.uniformMatrix4fv(s.getUniformLocation(e,"view"),!1,ie),s.uniformMatrix4fv(s.getUniformLocation(e,"model"),!1,Me),s.uniformMatrix4fv(s.getUniformLocation(e,"proj"),!1,se),V.Draw()}function ce(e){const t=e*.001,r=q===0?0:t-q;q=t,Ie(r),Le(),requestAnimationFrame(ce)}requestAnimationFrame(ce);
